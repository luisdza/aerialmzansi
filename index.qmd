---
title: "index"
format: html
editor: visual
---

## aerialmzansi

Mzansi from the air

```{r}
#usethis::edit_r_environ()
lat <- round(runif(1, 36.9, 42.1), 4)
lon <- round(runif(1, -114.1, -108.9), 4)
rand_pt <- data.frame(lon, lat) 
rand_pt_sf <- sf::st_as_sf(rand_pt, coords = c("lon", "lat"), crs = "+proj=longlat +datum=WGS84 +no_defs")

zoom <- 17

# note from https://docs.mapbox.com/help/glossary/zoom-level/
# zoom level 17 corresponds to 1.5 feet/pixel for 512x512
# w*1.5*1.5/ 5280 = 1/3 of a mile wide

scale <- 2.5
w <- 512*scale
h <- 512*scale

(img_url <- paste0(
  "https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/",
  paste0(lon, ",", lat),
  ",",zoom,",0/",w,"x",h,"@2x?access_token=", # first digit on this line is zoom level (between 0 and 22)
  Sys.getenv("MAPBOX_PUBLIC_ACCESS_TOKEN")
))

#temp_file <- tempfile(fileext = ".jpeg")
#download.file(img_url, temp_file)

image_name <- paste0('images/',as.character(Sys.time(), format = '%Y%m%d-%H%M'),".jpeg")
file.create(image_name)
download.file(img_url, image_name, mode = "wb")
```

